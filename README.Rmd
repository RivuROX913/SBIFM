---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# SBIFM

<!-- badges: start -->
<!-- badges: end -->

The goal of SBIFM is sparse modelling of high-dimensional covariance matrices using Bayesian latent factor models. The method proposed by [Bhattachrya et. al.](https://doi.org/10.1093/biomet/asr013) has been used to develop an efficient Gibbs sampler that scales well as data dimensionality increases. For automatically truncating the infinite loading matrix through selection of the number of important factors, we use the much more efficient truncation criteria proposed by [Schiavon et. al.]( https://doi.org/10.1002/sta4.298). 


## Installation

You can install the development version of SBIFM from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("RivuROX913/SBIFM")
```

## Example

This is a basic example which shows applications of different functions:

```{r example generation}
library(SBIFM)

## Generate synthetic data
set.seed(2143)
data = generateData(n = 200, p = 30, k = 10, rep = 5)
tail(data)
```

The function \texttt{generateData} generates a sparse loading matrix with given parameters and returns factor model data with that loading matrix along with other true parameters.

```{r example analysis}
## Analysis
out = GibbsCov(data, 10000, 3000, 7, 1e-4)
```

The function \texttt{GibsCov} runs the MCMC algorithm to estimate the covariance matrix and number of factors needed. If the true Covariance matrix is included in the data, it also returns the error in estimation:

```{r error and convergence}
## Error in covariance estimation
out$MSE

## Convergence rate
plot(out$post.factor[1:(data$p+10)], type = "l", xlab = "Iteration", ylab = "Number of factors", main = "Evolution of factors")
```

Above plot shows the average factors in the model across iterations for multiple replications of the data. As we can see, the convergence rate of the factors is almost linear.

```{r}
# Load the data
data <- psych::bfi[, 1:25]

head(data)
#diagnose for missing value
dlookr::diagnose(data)
visdat::vis_miss(data, sort_miss = FALSE)
#imputation
mice_model <- mice::mice(data, method='pmm', seed = 123)
data_complete <- mice::complete(mice_model)

visdat::vis_miss(data_complete, sort_miss = FALSE)


##analysis
datalist = list( "data" = data_complete, "replicate" = 1, "n" = nrow(data_complete), "p" = ncol(data_complete) )

out = GibbsCov(datalist, 20000, 5000, 3, 1e-4)


```

What is special about using `README.Rmd` instead of just `README.md`? You can include R chunks like so:

```{r cars}
summary(cars)
```

You'll still need to render `README.Rmd` regularly, to keep `README.md` up-to-date. `devtools::build_readme()` is handy for this.

You can also embed plots, for example:

```{r pressure, echo = FALSE}
plot(pressure)
```

In that case, don't forget to commit and push the resulting figure files, so they display on GitHub and CRAN.
